name: Send Email on PR Merged

on:
  pull_request:
    types:
      - closed

jobs:
  send_email:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Send Email using SendGrid
        run: |
          
          BODY="Hello,\n\nThe latest build on branch '${{ github.ref_name }}' has completed.\nStatus: $BUILD_STATUS\nCommit: ${{ github.sha }}\nTriggered by: ${{ github.actor }}\n\nView details: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          curl --request POST \
            --url https://api.sendgrid.com/v3/mail/send \
            --header "Authorization: Bearer ${{ secrets.SMTP_PASSWORD }}" \
            --header "Content-Type: application/json" \
            --data "{
              \"personalizations\": [
                {
                  \"to\": [{\"email\": \"jmoises@flvc.org\"}],
                  \"subject\": \"PR Merged in ${{ github.repository }}\"
                }
              ],
              \"from\": {\"email\": \"help@flvc.org\"},
              \"content\": [
                {
                  \"type\": \"text/plain\",
                  \"value\": \"$BODY\"
                }
              ]
            }"
